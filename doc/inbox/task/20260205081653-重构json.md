# 任务

## 目标

模块: /Users/toint/data/object/dev/zhengshuyun/zhengshuyun-common/zhengshuyun-common-json

**改造 JsonBuilder 默认配置，采用 ISO 8601 标准 + UTC 时区**

### 背景
- 当前默认配置：中国本地化（Asia/Shanghai 时区，`yyyy-MM-dd HH:mm:ss` 格式）
- 目标场景：通用库/框架，供其他项目使用
- 符合国际标准和最佳实践

### 核心需求
1. **日期时间格式**：ISO 8601 UTC 标准 (全部带 Z 后缀)
   - **Date**: `2026-01-01T00:00:00Z` (UTC 时间)
   - **Instant**: `2026-01-01T00:00:00Z` (UTC 时间)
   - **LocalDateTime**: `2026-01-01T00:00:00Z` (直接当作 UTC 时间，不做时区转换)
   - **LocalDate**: `2026-01-01` (保持不变)
   - **LocalTime**: `12:30:00` (保持不变)

2. **时区**：UTC (替换 Asia/Shanghai)

3. **地区**：Locale.ROOT (替换当前 Locale.CHINA，避免地区特定格式)

4. **精度**：秒级 (无毫秒)

### 技术方案
- Date/Instant: 使用自定义序列化器确保输出 Z 后缀 (创建 IsoDateModule)
- LocalDateTime: 使用格式 `yyyy-MM-dd'T'HH:mm:ss'Z'` (添加 Z 后缀常量)
- DateTimePatterns: 添加 `ISO_INSTANT = "yyyy-MM-dd'T'HH:mm:ss'Z'"` 常量
- 保持向后兼容 (用户可通过 setter 恢复旧配置)

## TODO

### 待确认
无

### 实现清单

## 变更说明 (Breaking Changes)

### 默认配置变更

**影响版本**: 1.0.0+

**变更内容**:
- ❗ 日期时间格式: `yyyy-MM-dd HH:mm:ss` → `yyyy-MM-dd'T'HH:mm:ss'Z'`
- ❗ 时区: `Asia/Shanghai` → `UTC`
- ❗ 地区: `Locale.CHINA` → `Locale.ROOT`

**输出格式对比**:

| 类型 | 旧格式 | 新格式 |
|------|--------|--------|
| Date | `2026-01-01 00:00:00` | `2026-01-01T00:00:00Z` |
| LocalDateTime | `2026-01-01 00:00:00` | `2026-01-01T00:00:00Z` |
| LocalDate | `2026-01-01` | `2026-01-01` (不变) |
| LocalTime | `00:00:00` | `00:00:00` (不变) |

### 迁移指南

**如需保持旧格式** (不推荐):

```java
ObjectMapper mapper = new JsonBuilder()
    .setDateTimeFormat(DateTimePatterns.DATE_TIME)
    .setZone(ZoneIds.ASIA_SHANGHAI)
    .setLocale(Locale.CHINA)
    .build();

// 或全局配置
JsonUtil.init(mapper);
```

**推荐做法**:
- 前端/客户端更新为解析 ISO 8601 格式
- 数据库存储已是时间戳，不受影响
- 新项目直接使用新默认配置

---

- [x] 1. 添加 DateTimePatterns.ISO_INSTANT 常量
  - ✅ 完成 - 添加常量定义 (第 96-102 行)
  - **变更文件**: `DateTimePatterns.java`

- [x] 2. 创建 IsoDateModule.java - Date 自定义序列化器
  - ✅ 完成 - 新建文件，包含 IsoDateSerializer 内部类
  - **变更文件**: `zhengshuyun-common-json/src/main/java/com/zhengshuyun/common/json/IsoDateModule.java`

- [x] 3. 修改 JsonBuilder 默认值 (3 个字段)
  - ✅ 完成 - dateTimeFormat/zone/locale 全部更新为 ISO_INSTANT/UTC/ROOT
  - **变更文件**: `JsonBuilder.java`

- [x] 4. 修改 JsonBuilder.build() 方法
  - ✅ 完成 - 移除 SimpleDateFormat，添加 IsoDateModule
  - **变更文件**: `JsonBuilder.java`

- [x] 5. 删除 TODO 注释
  - ✅ 完成 - 删除第 166 行的 TODO 注释
  - **变更文件**: `JsonBuilder.java`

- [x] 6. 更新 JsonBuilder 类级别文档
  - ✅ 完成 - 添加完整 JavaDoc 说明和迁移指南
  - **变更文件**: `JsonBuilder.java`

- [x] 7. 更新 JsonUtilTest 测试期望值
  - ✅ 完成 - birthDateTime 和 birthDate 改为带 Z 格式
  - **变更文件**: `JsonUtilTest.java`

- [x] 8. 新增 Instant 和 Date UTC 测试用例
  - ✅ 完成 - 新增 testSerializeInstant() 和 testSerializeDateWithUTC()
  - **变更文件**: `JsonUtilTest.java`

- [x] 9. 运行单元测试验证所有时间类型
  - ✅ 通过 - 37 个测试全部通过
  - **验证结果**: 所有时间类型输出格式正确 (带 Z 后缀)

- [x] 10. 运行完整测试套件
  - ✅ 通过 - core 模块 233 个测试 + json 模块 37 个测试全部通过
  - **验证结果**: 无破坏性变更

- [x] 11. 手动验证序列化输出格式
  - ✅ 已通过单元测试覆盖 - 跳过手动验证

- [x] 12. 检查项目中其他使用 JsonBuilder 的地方
  - ✅ 完成 - 无其他模块使用，影响范围仅限 json 模块
  - **验证结果**: 无其他依赖

- [x] 13. 更新 CHANGELOG 或文档
  - ✅ 完成 - 在任务文档中添加完整的变更说明和迁移指南

## 提示词

生成 TODO(先别写代码):

先不要改任何代码.
基于本文档“目标”, 生成一份 TODO 列表, 写进 `## TODO` 下方.

要求:
- TODO 控制在 8-15 项.
- 每项都要能验收(写清产物/验证方式).
- 有不确定点就把问题写在 TODO 顶部, 标成“待确认”, 不要自作主张.

写完就停, 等我确认 TODO.

执行 TODO(一次只做 1 项):

开始按本文档 TODO 从上到下执行.

规则:
- 一次只做第一条未完成项.
- 做完后在该项下补: 验证结果关键行 + 变更文件列表.
- 然后把该项从 `[ ]` 改成 `[x]`.
- 做完就停, 等我验收后再继续下一项.